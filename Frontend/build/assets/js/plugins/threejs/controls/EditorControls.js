THREE.EditorControls=function(e,t){t=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3,this.panSpeed=.001,this.zoomSpeed=.1,this.rotationSpeed=.005;var o=this,n=new THREE.Vector3,s=new THREE.Vector3,i=new THREE.Box3,r=-1,a=0,c=1,p=2,u=r,E=this.center,d=new THREE.Matrix3,v=new THREE.Vector2,l=new THREE.Vector2,m=new THREE.Spherical,h={type:"change"};function g(e){!1!==o.enabled&&(0===e.button?u=a:1===e.button?u=c:2===e.button&&(u=p),l.set(e.clientX,e.clientY),t.addEventListener("mousemove",T,!1),t.addEventListener("mouseup",y,!1),t.addEventListener("mouseout",y,!1),t.addEventListener("dblclick",y,!1))}function T(e){if(!1!==o.enabled){v.set(e.clientX,e.clientY);var t=v.x-l.x,n=v.y-l.y;u===a?o.rotate(s.set(-t*o.rotationSpeed,-n*o.rotationSpeed,0)):u===c?o.zoom(s.set(0,0,n)):u===p&&o.pan(s.set(-t,n,0)),l.set(e.clientX,e.clientY)}}function y(e){t.removeEventListener("mousemove",T,!1),t.removeEventListener("mouseup",y,!1),t.removeEventListener("mouseout",y,!1),t.removeEventListener("dblclick",y,!1),u=r}function f(e){e.preventDefault(),o.zoom(s.set(0,0,e.deltaY>0?1:-1))}function L(e){e.preventDefault()}this.focus=function(t){var n;i.setFromObject(t),!1===i.isEmpty()?(E.copy(i.getCenter()),n=i.getBoundingSphere().radius):(E.setFromMatrixPosition(t.matrixWorld),n=.1),s.set(0,0,1),s.applyQuaternion(e.quaternion),s.multiplyScalar(4*n),e.position.copy(E).add(s),o.dispatchEvent(h)},this.pan=function(t){var n=e.position.distanceTo(E);t.multiplyScalar(n*o.panSpeed),t.applyMatrix3(d.getNormalMatrix(e.matrix)),e.position.add(t),E.add(t),o.dispatchEvent(h)},this.zoom=function(t){var n=e.position.distanceTo(E);t.multiplyScalar(n*o.zoomSpeed),t.length()>n||(t.applyMatrix3(d.getNormalMatrix(e.matrix)),e.position.add(t),o.dispatchEvent(h))},this.rotate=function(t){n.copy(e.position).sub(E),m.setFromVector3(n),m.theta+=t.x,m.phi+=t.y,m.makeSafe(),n.setFromSpherical(m),e.position.copy(E).add(n),e.lookAt(E),o.dispatchEvent(h)},this.dispose=function(){t.removeEventListener("contextmenu",L,!1),t.removeEventListener("mousedown",g,!1),t.removeEventListener("wheel",f,!1),t.removeEventListener("mousemove",T,!1),t.removeEventListener("mouseup",y,!1),t.removeEventListener("mouseout",y,!1),t.removeEventListener("dblclick",y,!1),t.removeEventListener("touchstart",H,!1),t.removeEventListener("touchmove",R,!1)},t.addEventListener("contextmenu",L,!1),t.addEventListener("mousedown",g,!1),t.addEventListener("wheel",f,!1);var w=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],b=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],x=null;function H(e){if(!1!==o.enabled){switch(e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0),x=w[0].distanceTo(w[1])}b[0].copy(w[0]),b[1].copy(w[1])}}function R(e){if(!1!==o.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0),o.rotate(w[0].sub(r(w[0],b)).multiplyScalar(-o.rotationSpeed));break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0);var t=w[0].distanceTo(w[1]);o.zoom(s.set(0,0,x-t)),x=t;var n=w[0].clone().sub(r(w[0],b)),i=w[1].clone().sub(r(w[1],b));n.x=-n.x,i.x=-i.x,o.pan(n.add(i).multiplyScalar(.5))}b[0].copy(w[0]),b[1].copy(w[1])}function r(e,t){var o=t[0];for(var n in t)o.distanceTo(e)>t[n].distanceTo(e)&&(o=t[n]);return o}}t.addEventListener("touchstart",H,!1),t.addEventListener("touchmove",R,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EditorControls.prototype.constructor=THREE.EditorControls;